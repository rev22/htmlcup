<!DOCTYPE html>
<html><head><title>Loading: @htmlcup</title><script type="text/javascript">(function () {
        var timeout;
        timeout = function() {
          var x;
          x = document.createElement("div");
          x.id = "loadmsg";
          x.innerHTML = "Loading... <a href=\"?\">Reload</a>";
          return document.body.insertBefore(x, document.body.firstChild);
        };
        return window.htmlcupProtoLoadTimeout = setTimeout(timeout, 2000);
      })();
</script><style type="text/css">body, .fullpage, .reset { margin:0;padding:0;border:0 }
.fullpage { width:100%; height:100%; }
#sourcepane {
  opacity:0.2;
}
#sourcepane:hover {
  opacity:0.88;
}</style></head><body><div class="fullpage"><iframe class="fullpage" style="position:absolute"></iframe><textarea id="sourcepane" style="width:60%;
height:60%;
top:20%;
left:20%;
position:absolute;
z-index:1000000;">htmlcup.html5Page ->
  @head ->
    @title "My sweet page"
    @style type: "text/css",
      """
      body { background:pink }
      """
  @body ->
    @p 'Cupcake ipsum dolor. Sit amet I love sugar plum.'
    # And now a list
    @ol ->
      @li "Sweet jelly fruitcake"
      @li ->
        @a href: 'http://recipe.com/marzipan', 'Marzipan'
    @h2 "Loops: print cubes of numbers from 1 to 150"
    @span "#{x*x*x} " for x in [1..150]
</textarea></div><script type="text/javascript" src="http://js2coffee.org/scripts/coffeescript.min.js"></script><script type="text/javascript" src="htmlcup.js"></script><script type="text/javascript">(function () {
        var clearLoadTimeout, rmTag, sourcePane, update;
        rmTag = function(x) {
          return x.parentNode.removeChild(x);
        };
        htmlcup = htmlcup.extendObject({
          originalLib: htmlcup,
          capturedTokens: [],
          printHtml: function(t) {
            return this.capturedTokens.push(t);
          },
          captureHtml: function(f) {
            var o, p, r;
            o = this.capturedTokens;
            this.capturedTokens = [];
            f.apply(this);
            p = this.capturedTokens;
            this.capturedTokens = o;
            r = p.join("");
            this.printHtml(r);
            return r;
          },
          stripOuter: function(x) {
            return x.replace(/^<[^>]*>/, "").replace(/^<[^>]*>$/, "");
          },
          capturedParts: {},
          capturePart: function(tagName, stripOuter) {
            if (stripOuter == null) {
              stripOuter = this.stripOuter;
            }
            return function() {
              var x;
              x = arguments;
              return this.capturedParts[tagName] = stripOuter(this.captureHtml(function() {
                return this.originalLib[tagName].apply(this, x);
              }));
            };
          },
          body: function() {
            return (this.capturePart("body")).apply(this, arguments);
          },
          head: function() {
            var lib, r;
            lib = this.extendObject({
              title: function() {
                return (this.capturePart("title")).apply(this, arguments);
              },
              headStyles: [],
              style: function() {
                return this.headStyles.push((this.capturePart("style")).apply(this, arguments));
              }
            });
            r = (lib.capturePart("head")).apply(lib, arguments);
            this.capturedParts.headStyles = lib.headStyles;
            this.capturedParts.headTitle = lib.capturedParts.title;
            return r;
          },
          html5Page: function() {
            var r, x;
            x = arguments;
            this.captureHtml(function() {
              return this.originalLib.html5Page.apply(this, x);
            });
            r = this.capturedParts;
            this.capturedParts = {};
            return r;
          }
        });
        sourcePane = document.getElementById("sourcepane");
        update = function() {
          var body, headStyles, headTitle, innerDocument, style, x, _i, _j, _len, _len1, _ref, _ref1;
          _ref = CoffeeScript["eval"](sourcePane.value), body = _ref.body, headTitle = _ref.headTitle, headStyles = _ref.headStyles;
          innerDocument = window.frames[0].window.document;
          innerDocument.title = headTitle;
          _ref1 = innerDocument.head.getElementsByTagName("style");
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            x = _ref1[_i];
            rmTag(x);
          }
          if (headStyles) {
            for (_j = 0, _len1 = headStyles.length; _j < _len1; _j++) {
              style = headStyles[_j];
              x = innerDocument.createElement("style");
              x.innerHTML = style;
              innerDocument.getElementsByTagName("head")[0].appendChild(x);
            }
          }
          document.title = headTitle != null ? headTitle : "@htmlcup";
          return innerDocument.getElementsByTagName("body")[0].innerHTML = body;
        };
        sourcePane.onchange = update;
        sourcePane.oninput = function() {
          update();
          return false;
        };
        update();
        clearLoadTimeout = function() {
          var t;
          if ((t = window.htmlcupProtoLoadTimeout) != null) {
            window.clearTimeout(t);
          }
          delete window.htmlcupProtoLoadTimeout;
          if (t = document.getElementById("loadmsg")) {
            return rmTag(t);
          }
        };
        return clearLoadTimeout();
      })();
</script></body></html>