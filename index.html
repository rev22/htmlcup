<!DOCTYPE html>
<html><head><meta charset="utf-8"><link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAD/AAAA////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAERESIiIhERERESIiIiIRERESIiIiIhERESEiIiIiERESESIiIiIRERIRIiIiIhERESIiIiIiEREREREREREREREREQEQEREREREQARABEREREQAREQAREREQAREREAEREREAEREAERERERABEAEREREREQEQEREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"><title>@htmlcup</title><script type="text/javascript">(function () {
    var timeout;
    timeout = function() {
      var x;
      x = document.createElement("div");
      x.id = "loadmsg";
      x.innerHTML = "Loading... <a href=\"?\">Reload</a>";
      return document.body.insertBefore(x, document.body.firstChild);
    };
    return window.htmlcupProtoLoadTimeout = setTimeout(timeout, 2000);
  })();
</script><style type="text/css">body, .fullpage, .reset { margin:0;padding:0;border:0 }
.fullpage { width:100%; height:100%; }
#sourcepaneCnt {
  opacity:0.22;
}
#sourcepaneCnt:hover {
  opacity:0.88;
}
.sourcepaneTextarea {
  width:100%;
  height:100%;
  background: black;
  color: white;
}
.invertBg {
  color: white;
  background: black;
}
.messagePane {
  width:60%;height:20%;position:absolute;z-index:10000;
  text-align:center;
  margin-left:20%;
}
.error {
  color: yellow;
  font-weight: bold;
  background:#007;
}
.ribbonCnt {
  overflow: hidden;
  position: relative;
}
.ribbon, .ribbon a {
  background: #037;
  color: yellow;
  font-weight: bold;
  text-decoration: none;
}
.ribbon {
  text-align:center;
  transform: rotate(45deg);
  right: -60px;
  top: 30px;
  width: 200px;
  height: 20px;
  font-size: 16px;
  position: absolute;
  -webkit-transform:  rotate(45deg);
  -moz-transform:     rotate(45deg);
  -ms-transform:      rotate(45deg);
  -o-transform:       rotate(45deg);
  transform:          rotate(45deg);
  z-index: 1000000;
}</style></head><body><div class="fullpage"><div class="messagePane" id="messagepane"></div><iframe class="fullpage" style="position:absolute"></iframe><div id="sourcepaneCnt" class="ribbonCnt" style="width:70%;
height:70%;
top:15%;
right:15%;
position:absolute;
z-index:100;"><div class="ribbon"><a href="https://github.com/rev22/htmlcup" style="font-family:monospace,fixed" title="htmlcup 1.1.0-pre.7
Visit homepage">@htmlcup</a></div><textarea id="sourcepane" class="reset sourcepaneTextarea aceTransform">#
# Try &lt;htmlcup> in real-time here!
#
htmlcup.html5Page ->
  @head ->
    @title "hmlcup, caffeinated HTML"
    @cssStyle "body { background:cyan; font-size:18px; }"
  @body ->
    @h2 "@htmlcup - Generate HTML5 with CoffeeScript"
    @p "htmlcup has CoffeeScript's convenience and power, and is readily extensible"
    @h4 "Find more about:"
    @ul ->
      @li -> @a href:'http://github.com/rev22/htmlcup',  "htmlcup"
      @li -> @a href:'http://coffeescript.org',          "CoffeeScript"
    @h4 "Loops: print cubes of numbers from 1 to 10"
    @span title:"Cube of #{x}", "#{x*x*x} " for x in [1..10]
    @h4 "Scripting: simple clock"
    @p id:"clock"
    @coffeeScript ->
      updateClock = do (c = 0) -> ->
        document.getElementById("clock").innerHTML =
          "#{("｜／－＼")[c=(c+1)%4]} #{new Date}"
      setInterval updateClock, 125
</textarea></div></div><script type="text/javascript" src="http://js2coffee.org/scripts/coffeescript.min.js"></script><script type="text/javascript" src="htmlcup.js"></script><script type="text/javascript">(function() {
  window.timerman = function(win) {
    var clearInterval, clearTimeout, intervals, lib, setInterval, setTimeout, timeouts;
    if (win == null) {
      win = window;
    }
    setTimeout = win.setTimeout, setInterval = win.setInterval, clearInterval = win.clearInterval, clearTimeout = win.clearTimeout;
    intervals = {};
    timeouts = {};
    lib = {
      setTimeout: function(code, delay) {
        var id;
        id = setTimeout((function() {
          delete timeouts[id];
          return code();
        }), delay);
        timeouts[id] = code;
        return id;
      },
      clearTimeout: function(id) {
        var x;
        x = clearTimeout(id);
        delete timeouts[id];
        return x;
      },
      setInterval: function(code, delay) {
        var id;
        id = setInterval((function() {
          var error;
          try {
            return code();
          } catch (_error) {
            error = _error;
            lib.clearInterval(id);
            throw error;
          }
        }), delay);
        intervals[id] = code;
        return id;
      },
      clearInterval: function(id) {
        var x;
        x = clearTimeout(id);
        delete timeouts[id];
        return x;
      },
      clearAllTimeouts: function() {
        var x, _results;
        _results = [];
        for (x in timeouts) {
          _results.push(lib.clearTimeout(x));
        }
        return _results;
      },
      clearAllIntervals: function() {
        var x, _results;
        _results = [];
        for (x in intervals) {
          _results.push(lib.clearInterval(x));
        }
        return _results;
      },
      clearAll: function() {
        lib.clearAllTimeouts();
        return lib.clearAllIntervals();
      },
      intervals: intervals,
      timeouts: timeouts,
      original: {
        setTimeout: setTimeout,
        setInterval: setInterval,
        clearInterval: clearInterval,
        clearTimeout: clearTimeout
      },
      install: function(w) {
        var x, _results;
        if (w == null) {
          w = win;
        }
        _results = [];
        for (x in lib.original) {
          _results.push(w[x] = lib[x]);
        }
        return _results;
      },
      uninstall: function(w) {
        var x, _results;
        if (w == null) {
          w = win;
        }
        _results = [];
        for (x in lib.original) {
          _results.push(w[x] = lib.original[x]);
        }
        return _results;
      }
    };
    lib.install();
    return lib;
  };

}).call(this);
</script><script type="text/javascript">(function () {
    var clearLoadTimeout, delayUpdates, jsload, log, messagePane, rmTag, sourcePane, timerManager, update, updateSource, upgradeTextareas;
    rmTag = function(x) {
      return x.parentNode.removeChild(x);
    };
    log = function(x) {
      return console.log(x);
    };
    delayUpdates = function(minDelay, maxDelay) {
      return (function(minTimeout, maxTimeout) {
        return function(thunk) {
          return function() {
            var run;
            run = function() {
              if (minTimeout) {
                clearInterval(minTimeout);
              }
              if (maxTimeout) {
                clearInterval(maxTimeout);
              }
              minTimeout = null;
              maxTimeout = null;
              return thunk();
            };
            if (minTimeout) {
              clearInterval(minTimeout);
            }
            minTimeout = setTimeout(run, minDelay);
            if (!maxTimeout) {
              return maxTimeout = setTimeout(run, maxDelay);
            }
          };
        };
      })(null, null);
    };
    jsload = function(src, callback) {
      var x, y;
      log("Loading " + src);
      x = document.createElement('script');
      x.type = 'text/javascript';
      x.src = src;
      y = 1;
      x.onload = x.onreadystatechange = function() {
        if (y && !this.readyState || this.readyState === 'complete') {
          log("Loaded " + src);
          y = 0;
          return callback();
        }
      };
      return document.getElementsByTagName('head')[0].appendChild(x);
    };
    htmlcup = htmlcup.extendObject({
      originalLib: htmlcup,
      capturedTokens: [],
      printHtml: function(t) {
        return this.capturedTokens.push(t);
      },
      captureHtml: function(f) {
        var o, p, r;
        o = this.capturedTokens;
        this.capturedTokens = [];
        f.apply(this);
        p = this.capturedTokens;
        this.capturedTokens = o;
        r = p.join("");
        this.printHtml(r);
        return r;
      },
      stripOuter: function(x) {
        return x.replace(/^<[^>]*>/, "").replace(/<[^>]*>$/, "");
      },
      capturedParts: {},
      capturePart: function(tagName, stripOuter) {
        if (stripOuter == null) {
          stripOuter = this.stripOuter;
        }
        return function() {
          var x;
          x = arguments;
          return this.capturedParts[tagName] = stripOuter(this.captureHtml(function() {
            return this.originalLib[tagName].apply(this, x);
          }));
        };
      },
      body: function() {
        return (this.capturePart("body")).apply(this, arguments);
      },
      head: function() {
        var lib, r;
        lib = this.extendObject({
          title: function() {
            return (this.capturePart("title")).apply(this, arguments);
          },
          headStyles: [],
          style: function() {
            return this.headStyles.push((this.capturePart("style")).apply(this, arguments));
          }
        });
        r = (lib.capturePart("head")).apply(lib, arguments);
        this.capturedParts.headStyles = lib.headStyles;
        this.capturedParts.headTitle = lib.capturedParts.title;
        return r;
      },
      html5Page: function() {
        var r, x;
        x = arguments;
        this.captureHtml(function() {
          return this.originalLib.html5Page.apply(this, x);
        });
        r = this.capturedParts;
        this.capturedParts = {};
        return r;
      }
    });
    sourcePane = document.getElementById("sourcepane");
    messagePane = document.getElementById("messagepane");
    timerManager = null;
    updateSource = function(source) {
      var body, headStyles, headTitle, innerDocument, innerWindow, script, style, x, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2, _ref3;
      try {
        _ref = (function(htmlcup) {
          var code, env;
          env = eval("this");
          env.htmlcup = htmlcup;
          code = CoffeeScript.compile(source, {
            bare: true
          });
          try {
            return env["eval"]("" + code);
          } finally {
            env.htmlcup = htmlcup;
          }
        })(htmlcup), body = _ref.body, headTitle = _ref.headTitle, headStyles = _ref.headStyles;
        innerWindow = window.frames[0].window;
        if (timerManager != null) {
          timerManager.clearAll();
        } else {
          timerManager = timerman(innerWindow);
        }
        innerDocument = innerWindow.document;
        innerDocument.title = headTitle;
        _ref1 = innerDocument.head.getElementsByTagName("style");
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          x = _ref1[_i];
          rmTag(x);
        }
        if (headStyles) {
          for (_j = 0, _len1 = headStyles.length; _j < _len1; _j++) {
            style = headStyles[_j];
            x = innerDocument.createElement("style");
            x.innerHTML = style;
            innerDocument.getElementsByTagName("head")[0].appendChild(x);
          }
        }
        document.title = headTitle != null ? headTitle : "@htmlcup";
        innerDocument.getElementsByTagName("body")[0].innerHTML = body;
        _ref2 = innerDocument.getElementsByTagName("script");
        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
          script = _ref2[_k];
          innerWindow["eval"]((_ref3 = script.value) != null ? _ref3 : script.innerHTML);
        }
        return messagePane.innerHTML = "";
      } catch (error) {
        return messagePane.innerHTML = "<div class=error>" + (htmlcup.quoteText(error.toString())) + "</div>";
      }
    };
    update = (delayUpdates(300, 2000))(function() {
      return updateSource(sourcePane.value);
    });
    sourcePane.onchange = update;
    sourcePane.oninput = function() {
      update();
      return false;
    };
    update();
    clearLoadTimeout = function() {
      var t;
      if ((t = window.htmlcupProtoLoadTimeout) != null) {
        window.clearTimeout(t);
      }
      delete window.htmlcupProtoLoadTimeout;
      if (t = document.getElementById("loadmsg")) {
        return rmTag(t);
      }
    };
    clearLoadTimeout();
    upgradeTextareas = function(areas, callback) {
      var baseUrl, load;
      baseUrl = "http://ajaxorg.github.com/ace-builds/textarea/src/";
      if (!areas) {
        areas = document.getElementsByClassName("aceTransform");
      }
      if (!areas) {
        areas = document.getElementsByTagName("textarea");
      }
      if (!areas) {
        return;
      }
      load = window.__ace_loader__ = function(path, module, callback) {
        return jsload(baseUrl + path, function() {
          return window.__ace_shadowed__.require([module], callback);
        });
      };
      return load("ace-bookmarklet.js", "ace/ext/textarea", function() {
        var ace, require;
        ace = window.__ace_shadowed__;
        ace.options = {
          mode: "coffee",
          theme: "cobalt",
          gutter: "true",
          fontSize: "10px",
          softWrap: "off",
          keybindings: "ace",
          showPrintMargin: "true",
          useSoftTabs: "true",
          showInvisibles: "false"
        };
        require = ace.require;
        return require(["ace/layer/text"], function(_arg) {
          var Text, area, orig, patched, transformed, x, _i, _len, _results;
          Text = _arg.Text;
          orig = Text.prototype.$renderToken;
          patched = (function(rgx) {
            return function(builder, col, token, value) {
              var match, p, q, s, type, type_c;
              if (match = rgx.exec(value)) {
                type = token.type;
                type_c = type + ".camel";
                p = 0;
                while (true) {
                  console.log(match);
                  console.log(rgx.lastIndex);
                  q = rgx.lastIndex - 1;
                  s = value.substring(p, q);
                  col = orig.call(this, builder, col, {
                    type: type,
                    value: s
                  }, s);
                  s = value.substring(q, p = q + 1);
                  col = orig.call(this, builder, col, {
                    type: type_c,
                    value: s
                  }, s);
                  if (!(match = rgx.exec(value))) {
                    break;
                  }
                }
                s = value.substring(p);
                return orig.call(this, builder, col, {
                  type: type,
                  value: s
                }, s);
              } else {
                return orig.apply(this, arguments);
              }
            };
          })(new RegExp("[a-z][0-9]*[A-Z]", "g"));
          Text.prototype.$renderToken = patched;
          x = document.createElement("style");
          x.innerHTML = ".ace_camel { font-weight: bold; }";
          document.head.appendChild(x);
          transformed = [];
          if (!callback) {
            callback = (function() {});
          }
          _results = [];
          for (_i = 0, _len = areas.length; _i < _len; _i++) {
            area = areas[_i];
            _results.push(callback(area, ace.transformTextarea(area, load)));
          }
          return _results;
        });
      });
    };
    return upgradeTextareas(null, function(plain, ace) {
      update = (delayUpdates(300, 2000))(function() {
        return updateSource((sourcePane.value = ace.getValue()));
      });
      log("Upgrading textarea");
      ace.on("change", update);
      ace.on("blur", update);
      ace.setTheme("ace/theme/vibrant_ink");
      ace.getSession().setMode("ace/mode/coffee");
      return ace.getSession().setTabSize(2);
    });
  })();
</script></body></html>